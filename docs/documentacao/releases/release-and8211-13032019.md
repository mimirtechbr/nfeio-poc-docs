---
sidebar_label: "Release 13/03/2019"
sidebar_position: 1
slug: release-13-03-2019
date: 2020-09-24
last_update:
  date: 2020-10-30
title: "Release - 13/03/2019 - NFE.io | Docs"
description: "Novos Realeases lançados periodicamentes e adicionados aqui, para que você esteja sempre por dentro das mudanças em nossa plataforma e API's."
author: "Gabriel Marquez"
migration_info:
  migrated_on: "2025-08-18 03:18:51"
  migrated_by: "andrekutianski"
  source: "WordPress"
  source_id: 631
---

# Release - 13/03/2019

## Mudanças ocorridas no novo release:

[1\. Alteração no campo "Status" da nota fiscal][17]  
[2\. Mudança de campo nos detalhes do evento][18]  
[3\. Adicionado campo ID da empresa na GET da nota fiscal][19]  
[4\. Eventos retornando em ordem reversa][20]  
[5\. Criado o campo lastEvent no GET da nota fiscal][21]  
[6\. Alteração das actions do webhook][22]

## 1\. Status da nota

Para melhorar a análise do que está acontecendo com a nota fiscal, realizamos uma alteração no campo "Status", deixando de ser dados específicos do processamento para algo que define o estado da nota fiscal.

Dados específicos do processo de emissão:

### Antigo

Dados específicos do processo de emissão:

```javascript
{
    Final = -1,
    Created = 0,
    DefineNumberCompleted = 1,
    SentBatchCompleted = 2,
    CheckAuthorizationCompleted = 3,
    MergeAuthorizationProtocolCompleted = 4,
    DefineEventBatchCompleted = 5,
    SignXmlToCancelCompleted = 6,
    CancellationCompleted = 7,
    MergeCancellationCompleted = 8
}
```

### Novo

Neste padrão, poderá ser identificado quando a nota for:

* Criada
* Em processamento
* Emitida
* Cancelada
* Erro na emissão

```javascript
{
    Error = -1,
    None = 0,
    Created = 1,
    Processing = 2,
    Issued = 3,
    Cancelled = 4
}
```

## 2\. Details

* Validamos que o campo details poderá ser utilizado para outros fins, então, foi alterado o nome de **"details"** no plural, para **"data"**, assim deixando de ser um array de dados para um único objeto.
* Campo **"createdOn"** sai do objeto principal e incluso dentro do objeto "data"
* Alteração do nome **"event"** para **"type"**
* Mudança de nome de **"number"** para **"sequence"** nos eventos.

### Antigo

```javascript
    {
        "createdOn": "2019-03-07T13:10:13.5923056-03:00",
        "number": 2,
        "details": [
            {
                "issuedOn": "2019-01-29T13:53:33.6779461Z",
                "checkCode": 10585140,
                "accessKeyCheckDigit": "0",
                "accessKey": "NFe35190128456297000113550220000000091105851400"
            }
        ],
        "event": "InvoiceSetAccessKey"
    }
```

```javascript
  {
        "createdOn": "2019-03-08T19:54:46.0859773Z",
        "number": 1,
        "details": [
            {
                "batch": 8,
                "serie": 22,
                "number": 9
            }
        ],
        "event": "DefinedNumberAndSerieSuccessfully"
    },
```

### Novo

```javascript
{
        "sequence": 2,
        "data": 
        {
            "createdOn": "2019-01-29T13:53:33.6779461Z",
            "checkCode": 10585140,
            "accessKeyCheckDigit": "0",
            "accessKey": "NFe35190128456297000113550220000000091105851400"
        }
        "type": "InvoiceSetAccessKey"
    }
```

```javascript
   {
        "sequence": 1,
        "data":
        {
            "batch": 8,
            "serie": 22,
            "number": 9,
            "createdOn": "2019-01-29T13:53:33.6779461Z",
        },
        "type": "DefinedNumberAndSerieSuccessfully"
    },
```

## 3\. LastEvents

Alterado o GET da nota fiscal com:

* Adicionado o campo lastEvents no json mostrando os 10 últimos eventos ocorridos na nota fiscal.

> Observação: Os valores são os mesmos dados informados na request do /events

```javascript
 "lastEvents": {
        "hasMore": false,
        "events": [
            {
                "sequence": 7,
                "data": {
                    "createdOn": "2019-03-12T17:34:59.6835336Z",
                    "webhookDispatches": [
                        {
                            "webHookId": "cc2f1f718c1546c2958be667908198",
                            "id": "7a5415f959b44e1384940428de26c4"
                        }
                    ],
                    "action": "consumer_invoice.issued_successfully"
                },
                "type": "WebHooksDispatched"
            },
            {
                "sequence": 6,
                "data": {
                    "createdOn": "2019-03-12T17:34:50.6851410Z",
                    "contentType": "text/xml",
                    "uri": "http://url.xml"
                },
                "type": "Merged"
            },
            {
                "sequence": 5,
                "data": {
                    "createdOn": "2019-03-12T17:34:48.4145671Z",
                    "statusCode": 100,
                    "environmentType": "Test",
                    "validatorDigit": "7uwbxQvx4xWWy6DBMj3TGxufDPs=",
                    "protocolNumber": "135190000134000",
                    "description": "Autorizado o uso da NF-e",
                    "applicationVersion": "SP_NFCE_PL_009_V400",
                    "accessKey": "35190328456297000113650120000000571839920000"
                },
                "type": "Authorized"
            }
        ]
    }
```

## 4\. Eventos

Para melhorar a usabilidade da API, invertemos a ordem dos eventos de resposta na url /events.

* O último evento será o primeiro a aparecer no retorno da request

### Antigo

```javascript
{
    "hasMore": false,
    "events": [
        {
            "createdOn": "2019-03-08T19:54:46.0859773Z",
            "number": 1,
            "details": [
                {
                    "batch": 8,
                    "serie": 22,
                    "number": 9
                }
            ],
            "event": "DefinedNumberAndSerieSuccessfully"
        },
        {
            "createdOn": "2019-03-08T19:54:46.0859810Z",
            "number": 2,
            "details": [
                {
                    "issuedOn": "2019-01-29T13:53:33.6779461Z",
                    "checkCode": 10585140,
                    "accessKeyCheckDigit": "0",
                    "accessKey": "NFe35190128456297000113550220000000091105851400"
                }
            ],
            "event": "InvoiceSetAccessKey"
        }
    ]
}
```

### Novo

```javascript
{
    "hasMore": false,
    "events": [
        {
            "sequence": 6,
            "data": {
                "createdOn": "2019-03-12T17:34:50.6851410Z",
                "contentType": "text/xml",
                "uri": "http://url.xml"
            },
            "type": "Merged"
        },
        {
            "sequence": 5,
            "data": {
                "createdOn": "2019-03-12T17:34:48.4145671Z",
                "statusCode": 100,
                "environmentType": "Test",
                "validatorDigit": "7uwbxQvx4xWWy6DBMj3TGxufDPs=",
                "protocolNumber": "135190000134000",
                "description": "Autorizado o uso da NF-e",
                "applicationVersion": "SP_NFCE_PL_009_V400",
                "accessKey": "35190328456297000113650120000000571839920000"
            },
            "type": "Authorized"
        }
    ]
}
```

## 5\. Alteração do emissor no GET da nota fiscal

Para melhor identificação foi adicionado o id da empresa utilizada na emissão da nota fiscal.

```javascript
"issuer": {
    "id": "fe956f4d5c0f43d18f3736bd29b4ca37",
    "taxRegime": "SimplesNacional",
    "address": {
        "city": {
            "name": "São Paulo",
            "code": "3550308"
        },
        "state": "SP",
        "district": "MOEMA",
        "street": "RUA test",
        "number": "1458",
        "postalCode": "04522000",
        "country": "BRA"
    },
    "type": "Undefined",
    "specialTaxRegime": "Nenhum",
    "regionalTaxNumber": 118425254000,
    "name": "NF-E EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL",
    "federalTaxNumber": 28456297000100
}
```

## 6\. Mudança nas Actions do webhook

Alterado o padrão utilizado no enviado do webhook para identificação de quando ocorre um erro, falha ou sucesso.

> **Atenção:** Todos os seguintes WebHooks retornam o mesmo GET da nota fiscal, acrescentado por um campo "action" indicando o webhook acionado.
> 
> **Atenção:** WebHook composto por \[EventType\].\[EventAction\].  
> **Exemplos:**
> 
> * product\_invoice.issued\_successfully
> * product\_invoice.cancelled\_failed
> * consumer\_invoice.issued\_failed

### Antigo

As funções eram indicadas da seguinte forma:

**EventType**

| Chave             | Descrição                 |
| ----------------- | ------------------------- |
| service\_invoice  | Nota fiscal de Serviço    |
| consumer\_invoice | Nota fiscal de Consumidor |
| product\_invoice  | Nota fiscal de Produto    |

**EventAction**

| Chave     | Descrição                                                                                 |
| --------- | ----------------------------------------------------------------------------------------- |
| issued    | Qualquer acontecimento na emissão da nota fiscal (emitida, com erro ou com falha).        |
| cancelled | Qualquer acontecimento no cancelamento da nota fiscal (cancelada, com erro ou com falha). |

### Novo

Separamos as actions para melhor identificação do estado da nota fiscal.

Novo  
Separamos as actions para melhor identificação do estado da nota fiscal.

**EventType**

| Chave             | Descrição                 |
| ----------------- | ------------------------- |
| service\_invoice  | Nota fiscal de Serviço    |
| consumer\_invoice | Nota fiscal de Consumidor |
| product\_invoice  | Nota fiscal de Produto    |

**EventAction**

| Chave                   | Descrição                                                                            |
| ----------------------- | ------------------------------------------------------------------------------------ |
| issued\_successfully    | Nota emitida com sucesso.                                                            |
| issued\_failed          | Nota com falha no momento da emissão por retentativa ou por problemas técnicos.      |
| issued\_error           | Erro de preenchimento ou processo encerrado por retorno da SEFAZ na emissão.         |
| cancelled\_successfully | Nota cancelada com sucesso.                                                          |
| cancelled\_failed       | Nota com falha no momento do cancelamento por retentativa ou por problemas técnicos. |
| cancelled\_error        | Erro de preenchimento ou processo encerrado por retorno da SEFAZ no cancelamento.    |


[1]: #Release%5F-%5F13032019
[2]: #Mudancas%5Focorridas%5Fno%5Fnovo%5Frelease
[3]: #1%5FStatus%5Fda%5Fnota
[4]: #Antigo
[5]: #Novo
[6]: #2%5FDetails
[7]: #Antigo-2
[8]: #Novo-2
[9]: #3%5FLastEvents
[10]: #4%5FEventos
[11]: #Antigo-3
[12]: #Novo-3
[13]: #5%5FAlteracao%5Fdo%5Femissor%5Fno%5FGET%5Fda%5Fnota%5Ffiscal
[14]: #6%5FMudanca%5Fnas%5FActions%5Fdo%5Fwebhook
[15]: #Antigo-4
[16]: #Novo-4
[17]: https://nfe.io/docs/documentacao/nota-fiscal-consumidor/releases/release-13-03-2019/#1%5FStatus%5Fda%5Fnota
[18]: https://nfe.io/docs/documentacao/nota-fiscal-consumidor/releases/release-13-03-2019/#2%5FDetails
[19]: https://nfe.io/docs/documentacao/nota-fiscal-consumidor/releases/release-13-03-2019/#3%5FLastEvents
[20]: https://nfe.io/docs/documentacao/nota-fiscal-consumidor/releases/release-13-03-2019/#4%5FEventos
[21]: https://nfe.io/docs/documentacao/nota-fiscal-consumidor/releases/release-13-03-2019/#5%5FAlteracao%5Fdo%5Femissor%5Fno%5FGET%5Fda%5Fnota%5Ffiscal
[22]: https://nfe.io/docs/documentacao/nota-fiscal-consumidor/releases/release-13-03-2019/#6%5FMudanca%5Fnas%5FActions%5Fdo%5Fwebhook